

<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MinecraftåŒ…åŠ å¯†/è§£å¯†å·¥å…·</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="main_ui.css">
<script src="./jszip.min.js"></script>
<style>
/* å…¨å±€CSSå˜é‡å’ŒåŸºç¡€æ ·å¼ */
:root {
  --primary: #000;
  --success: #22c55e;
  --error: #ef4444;
  --warning: #f59e0b;
  --info: #3b82f6;
  --text: #1f2937;
  --text-secondary: #6b7280;
  --bg: #f9fafb;
  --card-bg: #ffffff;
  --border: #e5e7eb;
  --radius: 8px;
  --radius-lg: 12px;
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --transition: all 0.2 ease;
}

[data-theme="dark"] {
  --primary: #ffffff;
  --text: #f9fafb;
  --text-secondary: #d1d5db;
  --bg: #1f2937;
  --card-bg: #374151;
  --border: #4b5563;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
}



.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: var(--radius);
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  text-decoration: none;
  font-size: 0.875rem;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  opacity: 0.9;
  transform: translateY(-1px);
}

.btn-secondary {
  background: var(--text-secondary);
  color: white;
}




.btn-outline {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text);
}

.btn-outline:hover {
  background: var(--bg);
}

.btn-lg {
  padding: 1rem 2rem;
  font-size: 1rem;
}

.btn-full {
  width: 100%;
  justify-content: center;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.input {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: var(--card-bg);
  color: var(--text);
  font-size: 0.875rem;
}

.input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.label {
  font-weight: 500;
  color: var(--text);
}

.text-secondary {
  color: var(--text-secondary);
  font-size: 0.75rem;
}

.badge {
  padding: 0.25rem 0.75rem;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 500;
}

.badge-success {
  background: rgba(34, 197, 94, 0.1);
  color: var(--success);
  border: 1px solid rgba(34, 197, 94, 0.2);
}

.hidden {
  display: none !important;
}

.logo {
  width: 48px;
  height: 48px;
  background: var(--primary);
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.5rem;
}



.spinner {
  display: inline-block;
  width: 16px;
  height: 16px;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: spin 1 linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* åŒ…ä¿¡æ¯æ ·å¼ */
.pack-info {
  background: var(--bg);
  border-radius: var(--radius);
  padding: 1rem;
  border: 1px solid var(--border);
}

.pack-info-item {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--border);
}

.pack-info-item:last-child {
  border-bottom: none;
}

.pack-info-label {
  font-weight: 500;
  color: var(--text-secondary);
}

.pack-info-value {
  color: var(--text);
  max-width: 60%;
  text-align: right;
}

/* æ‰©å±•æ ·å¼ */
.mobile-warning-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
}

.mobile-warning-content {
    background: var(--card-bg);
    border-radius: var(--radius-lg);
    padding: 2rem;
    max-width: 400px;
    width: 90%;
    text-align: center;
    box-shadow: var(--shadow-md);
}

.mobile-warning-icon {
    font-size: 4rem;
    color: var(--primary);
    margin-bottom: 1rem;
}

.mobile-warning-content h2 {
    margin-bottom: 1rem;
    color: var(--text);
}

.mobile-warning-content ul {
    list-style: none;
    padding: 0;
}

.mobile-warning-content li {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    color: var(--text-secondary);
}

.header {
    background: var(--card-bg);
    border-bottom: 1px solid var(--border);
    padding: 1.5rem 0;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(10px);
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.brand {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.brand-text h1 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text);
    display: flex;
    margin: 0;
}

.brand-subtitle {
    font-size: 0.875rem;
    color: var(--text-secondary);
    display: flex;
    font-weight: 400;
}

.main-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
    display: grid;
    grid-template-columns: 1fr 350px;
    gap: 2rem;
}

.content-area {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.sidebar {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.tab-container {
    display: flex;
    border-bottom: 1px solid var(--border);
    margin-bottom: 2rem;
}

.tab-button {
    flex: 1;
    padding: 1rem 2rem;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: var(--transition);
    font-size: 1rem;
    font-weight: 500;
}

.tab-button.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
}

.tab-button:hover {
    color: var(--text);
    background: var(--bg);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.upload-zone {
    background: var(--bg);
    border: 2px dashed var(--border);
    border-radius: var(--radius-lg);
    padding: 3rem 2rem;
    text-align: center;
    transition: var(--transition);
    cursor: pointer;
}

.upload-zone:hover {
    border-color: var(--primary);
    background: rgba(0, 0, 0, 0.02);
}

.upload-zone.dragover {
    border-color: var(--primary);
    background: rgba(0, 0, 0, 0.05);
    transform: scale(1.02);
}

.upload-icon {
    font-size: 4rem;
    color: var(--primary);
    margin-bottom: 1.5rem;
}

.upload-zone h3 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--text);
}

.upload-zone p {
    color: var(--text-secondary);
    margin-bottom: 2rem;
}

.upload-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.file-list {
    max-height: 400px;
    overflow-y: auto;
}

.file-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    border-bottom: 1px solid var(--border);
    transition: var(--transition);
}

.file-item:last-child {
    border-bottom: none;
}

.file-item:hover {
    background: var(--bg);
}

.file-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.file-icon {
    width: 40px;
    height: 40px;
    background: var(--primary);
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.file-details h4 {
    margin: 0;
    font-size: 1rem;
    color: var(--text);
}

.file-details p {
    margin: 0;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

.stat-card {
    background: var(--bg);
    border-radius: var(--radius);
    padding: 1.5rem;
    text-align: center;
    border: 1px solid var(--border);
    transition: var(--transition);
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.stat-icon {
    width: 48px;
    height: 48px;
    background: var(--primary);
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
    margin: 0 auto 1rem;
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 0.5rem;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.progress {
    width: 100%;
    height: 12px;
    background: var(--bg);
    border-radius: 999px;
    overflow: hidden;
    margin-top: 1rem;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #000, #000);
    transition: width 0.3 ease;
    width: 0%;
}

.action-area {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    font-size: 0.875rem;
    font-weight: 500;
}

.status-online {
    background: rgba(34, 197, 94, 0.1);
    color: var(--success);
    border: 1px solid rgba(34, 197, 94, 0.2);
}

.status-offline {
    background: rgba(239, 68, 68, 0.1);
    color: var(--error);
    border: 1px solid rgba(239, 68, 68, 0.2);
}

.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.toast {
    max-width: 400px;
    padding: 1rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    animation: slideIn 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.toast-success {
    background: rgba(34, 197, 94, 0.1);
    color: var(--success);
    border: 1px solid rgba(34, 197, 94, 0.2);
}

.toast-error {
    background: rgba(239, 68, 68, 0.1);
    color: var(--error);
    border: 1px solid rgba(239, 68, 68, 0.2);
}

.toast-info {
    background: rgba(59, 130, 246, 0.1);
    color: var(--info);
    border: 1px solid rgba(59, 130, 246, 0.2);
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOut {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

@media (max-width: 768px) {
    .main-container {
        grid-template-columns: 1fr;
        padding: 1rem;
    }
    
    .brand {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    
    .brand-text h1 {
        font-size: 2rem;
    }
    
    .upload-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

</style>
</head>
<body>
<!-- ç§»åŠ¨ç«¯è­¦å‘Šé®ç½© -->
<div class="mobile-warning-overlay" id="mobileWarning" style="display: none;">
<div class="mobile-warning-content">
    <div class="mobile-warning-icon">
        <i class="fas fa-mobile-alt"></i>
    </div>
    <h2>ç§»åŠ¨ç«¯ä¸æ”¯æŒ</h2>
    <p>æŠ±æ­‰ï¼Œæ­¤å·¥å…·éœ€è¦åœ¨æ¡Œé¢ç«¯æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œå› ä¸ºéœ€è¦å¤„ç†æ–‡ä»¶å¤¹å’Œå¤§é‡æ–‡ä»¶æ“ä½œã€‚</p>
    <div style="margin: 1.5rem 0;">
        <h3>ä¸ºä»€ä¹ˆä¸æ”¯æŒç§»åŠ¨ç«¯ï¼Ÿ</h3>
        <ul style="text-align: left; margin-top: 1rem;">
            <li><i class="fas fa-folder"></i> éœ€è¦æ–‡ä»¶å¤¹æ‹–æ‹½åŠŸèƒ½</li>
            <li><i class="fas fa-file-archive"></i> éœ€è¦å¤„ç†ZIPæ–‡ä»¶</li>
            <li><i class="fas fa-memory"></i> éœ€è¦å¤§é‡å†…å­˜å¤„ç†æ–‡ä»¶</li>
            <li><i class="fas fa-download"></i> éœ€è¦æ‰¹é‡ä¸‹è½½åŠŸèƒ½</li>
        </ul>
    </div>
    <button class="btn btn-primary" onclick="closeMobileWarning()">
        <i class="fas fa-times"></i>
        æˆ‘äº†è§£äº†
    </button>
</div>
</div>

<!-- Header -->
<div class="header">
<div class="header-content">
    <div class="brand">
        <div class="logo"><i class="fas fa-shield-alt"></i></div>
        <div class="brand-text">
            <h1>MinecraftåŒ…åŠ å¯†/è§£å¯†å·¥å…·</h1>
            <div class="brand-subtitle">å®‰å…¨ã€å¿«é€Ÿåœ°åŠ å¯†æˆ–è§£å¯†æ‚¨çš„Minecraftèµ„æºåŒ…å’Œè¡Œä¸ºåŒ…</div>
        </div>
        <div id="api-status" class="status-indicator status-offline">
            <i class="fas fa-circle"></i>
            æ£€æŸ¥ä¸­...
        </div>
    </div>
</div>
</div>
<!-- Main Content -->
<div class="main-container">
<!-- Content Area -->
<div class="content-area">
    <!-- Tab Navigation -->
    <div class="tab-container">
        <button class="tab-button active" onclick="switchTab('encrypt')">
            <i class="fas fa-lock"></i>
            åŠ å¯†åŒ…
        </button>
        <button class="tab-button" onclick="switchTab('decrypt')">
            <i class="fas fa-unlock"></i>
            è§£å¯†åŒ…
        </button>
    </div>

    <!-- Encrypt Tab Content -->
    <div id="encrypt-tab" class="tab-content active">
        <!-- Upload Section for Encryption -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-upload"></i>
                    é€‰æ‹©è¦åŠ å¯†çš„åŒ…æ–‡ä»¶
                </div>
            </div>
            <div class="upload-zone" id="encryptUploadZone">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h3>æ‹–æ‹½æ–‡ä»¶å¤¹åˆ°è¿™é‡Œ</h3>
                <p>æˆ–è€…ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶</p>
                <div class="upload-buttons">
                    <button class="btn btn-primary" onclick="document.getElementById('encryptFolderInput').click()">
                        <i class="fas fa-folder-open"></i>
                        é€‰æ‹©æ–‡ä»¶å¤¹
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('encryptFileInput').click()">
                        <i class="fas fa-file-archive"></i>
                        é€‰æ‹©ZIPæ–‡ä»¶
                    </button>
                </div>
                <input type="file" id="encryptFolderInput" webkitdirectory multiple style="display: none;">
                <input type="file" id="encryptFileInput" accept=".zip,.mcpack" style="display: none;">
            </div>
        </div>
    </div>

    <!-- Decrypt Tab Content -->
    <div id="decrypt-tab" class="tab-content">
        <!-- Upload Section for Decryption -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <i class="fas fa-upload"></i>
                    é€‰æ‹©è¦è§£å¯†çš„åŒ…æ–‡ä»¶
                </div>
            </div>
            <div class="upload-zone" id="decryptUploadZone">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h3>æ‹–æ‹½åŠ å¯†åŒ…åˆ°è¿™é‡Œ</h3>
                <p>æ”¯æŒåŠ å¯†çš„ZIPåŒ…æˆ–æ–‡ä»¶å¤¹</p>
                <div class="upload-buttons">
                    <button class="btn btn-primary" onclick="document.getElementById('decryptFolderInput').click()">
                        <i class="fas fa-folder-open"></i>
                        é€‰æ‹©æ–‡ä»¶å¤¹
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('decryptFileInput').click()">
                        <i class="fas fa-file-archive"></i>
                        é€‰æ‹©ZIPæ–‡ä»¶
                    </button>
                </div>
                <input type="file" id="decryptFolderInput" webkitdirectory multiple style="display: none;">
                <input type="file" id="decryptFileInput" accept=".zip,.mcpack" style="display: none;">
            </div>
        </div>
    </div>

    <!-- File List Section -->
    <div class="card" id="fileListSection" style="display: none;">
        <div class="card-header">
            <div class="card-title">
                <i class="fas fa-list"></i>
                å·²é€‰æ‹©çš„æ–‡ä»¶
            </div>
            <span class="badge badge-success">
                <span id="fileCount">0</span> ä¸ªæ–‡ä»¶
            </span>
        </div>
        <div class="file-list" id="fileList"></div>
    </div>

    <!-- Progress Section -->
    <div class="card" id="progressSection" style="display: none;">
        <div class="card-header">
            <div class="card-title">
                <i class="fas fa-spinner fa-spin"></i>
                å¤„ç†è¿›åº¦
            </div>
            <span id="progressText">å‡†å¤‡ä¸­...</span>
        </div>
        <div class="progress">
            <div class="progress-bar" id="progressFill"></div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="card" id="resultsSection" style="display: none;">
        <div class="card-header">
            <div class="card-title">
                <i class="fas fa-chart-bar"></i>
                <span id="resultTitle">å¤„ç†ç»“æœ</span>
            </div>
        </div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-file-code"></i>
                </div>
                <div class="stat-value" id="processedFiles">0</div>
                <div class="stat-label" id="processedLabel">å¤„ç†æ–‡ä»¶æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-files"></i>
                </div>
                <div class="stat-value" id="totalFiles">0</div>
                <div class="stat-label">æ€»æ–‡ä»¶æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-cube"></i>
                </div>
                <div class="stat-value" id="packageName">-</div>
                <div class="stat-label">åŒ…åç§°</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-key"></i>
                </div>
                <div class="stat-value" id="operationKey">-</div>
                <div class="stat-label">ä½¿ç”¨å¯†é’¥</div>
            </div>
        </div>
        <div id="packDetailsInfo" class="pack-info" style="margin-top: 1rem;"></div>
    </div>
</div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Settings Section -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-cog"></i>
                        è®¾ç½®
                    </div>
                </div>
                <div class="form-group">
                    <label class="label">è‡ªå®šä¹‰å¯†é’¥ (å¯é€‰)</label>
                    <input type="text" class="input" id="customKey" placeholder="ç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆ">
                    <small class="text-secondary">32å­—ç¬¦çš„å­—æ¯æ•°å­—ç»„åˆ</small>
                    <button class="btn btn-outline btn-full" onclick="generateKey()">
                        <i class="fas fa-random"></i>
                        ç”Ÿæˆéšæœºå¯†é’¥
                    </button>
                </div>
            </div>

    <!-- Action Area -->
    <div class="action-area">
        <button class="btn btn-primary btn-lg btn-full" id="processBtn" onclick="processFiles()" disabled>
            <i class="fas fa-lock"></i>
            <span id="processBtnText">å¼€å§‹åŠ è§£å¯†</span>
        </button>
        <button class="btn btn-success btn-lg btn-full hidden" id="downloadBtn" onclick="downloadResult()">
            <i class="fas fa-download"></i>
            ä¸‹è½½ç»“æœ
        </button>
        <button class="btn btn-warning btn-full" onclick="cleanupFiles()">
            <i class="fas fa-trash"></i>
            æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        </button>
    </div>
</div>
</div>

<!-- Theme Toggle -->


<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<script>
// API åŸºç¡€URL
const API_BASE = 'https://www.menthamc.club:5000';

let selectedFiles = [];
let extractedFiles = [];
let currentDownloadFilename = null;
let currentMode = 'encrypt'; // 'encrypt' or 'decrypt'
let isProcessingZip = false;

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    setupFileUpload();
    checkApiStatus();
    checkMobileDevice();
    switchTab('encrypt'); // é»˜è®¤åŠ å¯†æ¨¡å¼
});

// æ£€æŸ¥ç§»åŠ¨è®¾å¤‡
function checkMobileDevice() {
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    if (isMobile) {
        document.getElementById('mobileWarning').style.display = 'flex';
    }
}

function closeMobileWarning() {
    document.getElementById('mobileWarning').style.display = 'none';
}

// åˆ‡æ¢æ ‡ç­¾é¡µ
function switchTab(mode) {
    currentMode = mode;
    
    // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`.tab-button[onclick="switchTab('${mode}')"]`).classList.add('active');
    
    // æ›´æ–°å†…å®¹æ˜¾ç¤º
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.getElementById(`${mode}-tab`).classList.add('active');
    
    // æ›´æ–°UIæ–‡æœ¬
    if (mode === 'encrypt') {
        document.getElementById('processBtnText').textContent = 'å¼€å§‹åŠ å¯†';
        document.getElementById('processBtn').innerHTML = '<i class="fas fa-lock"></i> å¼€å§‹åŠ å¯†';
        document.getElementById('customKey').placeholder = 'ç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆ';
    } else {
        document.getElementById('processBtnText').textContent = 'å¼€å§‹è§£å¯†';
        document.getElementById('processBtn').innerHTML = '<i class="fas fa-unlock"></i> å¼€å§‹è§£å¯†';
        document.getElementById('customKey').placeholder = 'ç•™ç©ºå°†ä½¿ç”¨é»˜è®¤å¯†é’¥';
    }
    
    // é‡ç½®é€‰æ‹©çš„æ–‡ä»¶
    selectedFiles = [];
    extractedFiles = [];
    updateProcessButton();
    hideResults();
}

// æ–‡ä»¶ä¸Šä¼ è®¾ç½®
function setupFileUpload() {
    // åŠ å¯†æ¨¡å¼çš„æ–‡ä»¶ä¸Šä¼ 
    setupUploadZone('encryptUploadZone', ['encryptFolderInput', 'encryptFileInput']);
    // è§£å¯†æ¨¡å¼çš„æ–‡ä»¶ä¸Šä¼ 
    setupUploadZone('decryptUploadZone', ['decryptFolderInput', 'decryptFileInput']);
}

function setupUploadZone(zoneId, inputIds) {
    const uploadZone = document.getElementById(zoneId);
    const inputs = inputIds.map(id => document.getElementById(id));

    // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
    inputs.forEach(input => {
        input.addEventListener('change', handleFileSelect);
    });

    // æ‹–æ‹½åŠŸèƒ½
    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        
        const files = Array.from(e.dataTransfer.files);
        if (files.length > 0) {
            handleDroppedFiles(files);
        }
    });
}

// å¤„ç†æ–‡ä»¶é€‰æ‹©ï¼ˆä¿®æ”¹ç°æœ‰å‡½æ•°ï¼‰
async function handleFileSelect(event) {
    const files = Array.from(event.target.files);
    await processSelectedFiles(files);
}

// å¤„ç†æ‹–æ‹½æ–‡ä»¶ï¼ˆä¿®æ”¹ç°æœ‰å‡½æ•°ï¼‰
async function handleDroppedFiles(files) {
    await processSelectedFiles(files);
}

// å¤„ç†é€‰æ‹©çš„æ–‡ä»¶ï¼ˆæ–°å‡½æ•°ï¼‰
async function processSelectedFiles(files) {
    // æ£€æŸ¥æ˜¯å¦æœ‰ZIPæ–‡ä»¶
    const zipFiles = files.filter(file => 
        file.name.toLowerCase().endsWith('.zip') || 
        file.name.toLowerCase().endsWith('.mcpack')
    );
    
    if (zipFiles.length > 0) {
        // å¦‚æœæœ‰ZIPæ–‡ä»¶ï¼Œå…ˆè§£å‹
        await handleZipFiles(zipFiles, files);
    } else {
        // æ²¡æœ‰ZIPæ–‡ä»¶ï¼Œç›´æ¥å¤„ç†
        selectedFiles = files;
        displayFileList(files);
        updateProcessButton();
    }
}

// å¤„ç†ZIPæ–‡ä»¶
async function handleZipFiles(zipFiles, allFiles) {
    if (isProcessingZip) {
        showToast('æ­£åœ¨å¤„ç†ZIPæ–‡ä»¶ï¼Œè¯·ç¨å€™...', 'warning');
        return;
    }
    
    isProcessingZip = true;
    showToast('æ­£åœ¨è§£å‹ZIPæ–‡ä»¶...', 'info');
    
    try {
        extractedFiles = [];
        const nonZipFiles = allFiles.filter(file => 
            !file.name.toLowerCase().endsWith('.zip') && 
            !file.name.toLowerCase().endsWith('.mcpack')
        );
        
        // æ·»åŠ éZIPæ–‡ä»¶
        extractedFiles.push(...nonZipFiles);
        
        // å¤„ç†æ¯ä¸ªZIPæ–‡ä»¶
        for (const zipFile of zipFiles) {
            const extractedFromZip = await extractZipFile(zipFile);
            extractedFiles.push(...extractedFromZip);
        }
        
        // æ˜¾ç¤ºè§£å‹ç»“æœ
        selectedFiles = extractedFiles;
        displayFileList(extractedFiles);
        updateProcessButton();
        
        showToast(`æˆåŠŸè§£å‹ ${zipFiles.length} ä¸ªZIPæ–‡ä»¶ï¼Œå…±æå– ${extractedFiles.length} ä¸ªæ–‡ä»¶`, 'success');
        
    } catch (error) {
        console.error('ZIPæ–‡ä»¶å¤„ç†å¤±è´¥:', error);
        showToast('ZIPæ–‡ä»¶è§£å‹å¤±è´¥: ' + error.message, 'error');
        
        // å¦‚æœè§£å‹å¤±è´¥ï¼Œå›é€€åˆ°åŸå§‹æ–‡ä»¶
        selectedFiles = allFiles;
        displayFileList(allFiles);
        updateProcessButton();
    } finally {
        isProcessingZip = false;
    }
}

// è§£å‹å•ä¸ªZIPæ–‡ä»¶
async function extractZipFile(zipFile) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        
        reader.onload = async function(e) {
            try {
                const zip = new JSZip();
                const zipData = await zip.loadAsync(e.target.result);
                const extractedFiles = [];
                
                // éå†ZIPä¸­çš„æ‰€æœ‰æ–‡ä»¶
                for (const [fileName, fileObj] of Object.entries(zipData.files)) {
                    // è·³è¿‡ç›®å½•
                    if (fileObj.dir) continue;
                    
                    // è·å–æ–‡ä»¶å†…å®¹
                    const fileContent = await fileObj.async('blob');
                    
                    // åˆ›å»ºæ–°çš„Fileå¯¹è±¡
                    const extractedFile = new File([fileContent], fileName, {
                        type: getFileType(fileName),
                        lastModified: fileObj.date ? fileObj.date.getTime() : Date.now()
                    });
                    
                    // æ·»åŠ åŸå§‹ZIPæ–‡ä»¶ä¿¡æ¯
                    extractedFile.sourceZip = zipFile.name;
                    extractedFile.originalPath = fileName;
                    
                    extractedFiles.push(extractedFile);
                }
                
                resolve(extractedFiles);
            } catch (error) {
                reject(new Error(`è§£å‹ ${zipFile.name} å¤±è´¥: ${error.message}`));
            }
        };
        
        reader.onerror = () => reject(new Error(`è¯»å– ${zipFile.name} å¤±è´¥`));
        reader.readAsArrayBuffer(zipFile);
    });
}

// æ ¹æ®æ–‡ä»¶ååˆ¤æ–­MIMEç±»å‹
function getFileType(fileName) {
    const ext = fileName.split('.').pop().toLowerCase();
    const typeMap = {
        'json': 'application/json',
        'png': 'image/png',
        'jpg': 'image/jpeg',
        'jpeg': 'image/jpeg',
        'gif': 'image/gif',
        'txt': 'text/plain',
        'js': 'text/javascript',
        'css': 'text/css',
        'html': 'text/html',
        'wav': 'audio/wav',
        'ogg': 'audio/ogg',
        'mcmeta': 'application/json',
        'mcfunction': 'text/plain'
    };
    
    return typeMap[ext] || 'application/octet-stream';
}

// ä¿®æ”¹æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨å‡½æ•°ï¼Œæ˜¾ç¤ºè§£å‹ä¿¡æ¯
function displayFileList(files) {
    const fileListSection = document.getElementById('fileListSection');
    const fileList = document.getElementById('fileList');
    const fileCount = document.getElementById('fileCount');

    fileList.innerHTML = '';
    fileCount.textContent = files.length;

    // ç»Ÿè®¡ZIPæ¥æº
    const zipSources = {};
    const regularFiles = [];
    
    files.forEach(file => {
        if (file.sourceZip) {
            if (!zipSources[file.sourceZip]) {
                zipSources[file.sourceZip] = [];
            }
            zipSources[file.sourceZip].push(file);
        } else {
            regularFiles.push(file);
        }
    });

    let displayCount = 0;
    const maxDisplay = 20;

    // æ˜¾ç¤ºZIPæ¥æºçš„æ–‡ä»¶
    for (const [zipName, zipFiles] of Object.entries(zipSources)) {
        if (displayCount >= maxDisplay) break;
        
        // ZIPæ–‡ä»¶ç»„æ ‡é¢˜
        const zipGroupItem = document.createElement('div');
        zipGroupItem.className = 'file-item';
        zipGroupItem.style.backgroundColor = 'var(--bg)';
        zipGroupItem.innerHTML = `
            <div class="file-info">
                <div class="file-icon" style="background: var(--info);">
                    <i class="fas fa-file-archive"></i>
                </div>
                <div class="file-details">
                    <h4>ğŸ“¦ ${zipName}</h4>
                    <p>åŒ…å« ${zipFiles.length} ä¸ªæ–‡ä»¶</p>
                </div>
            </div>
        `;
        fileList.appendChild(zipGroupItem);
        displayCount++;

        // æ˜¾ç¤ºZIPä¸­çš„æ–‡ä»¶ï¼ˆæœ€å¤šæ˜¾ç¤º5ä¸ªï¼‰
        const filesToShow = zipFiles.slice(0, 5);
        filesToShow.forEach(file => {
            if (displayCount >= maxDisplay) return;
            
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.style.marginLeft = '20px';
            fileItem.innerHTML = `
                <div class="file-info">
                    <div class="file-icon">
                        <i class="fas ${getFileIcon(file.name)}"></i>
                    </div>
                    <div class="file-details">
                        <h4>${file.originalPath || file.name}</h4>
                        <p>${formatFileSize(file.size)} â€¢ æ¥è‡ªZIP</p>
                    </div>
                </div>
            `;
            fileList.appendChild(fileItem);
            displayCount++;
        });

        // å¦‚æœZIPä¸­æ–‡ä»¶å¤ªå¤šï¼Œæ˜¾ç¤ºçœç•¥ä¿¡æ¯
        if (zipFiles.length > 5) {
            const moreItem = document.createElement('div');
            moreItem.className = 'file-item';
            moreItem.style.marginLeft = '20px';
            moreItem.style.opacity = '0.7';
            moreItem.innerHTML = `
                <div class="file-info">
                    <div class="file-icon">
                        <i class="fas fa-ellipsis-h"></i>
                    </div>
                    <div class="file-details">
                        <h4>è¿˜æœ‰ ${zipFiles.length - 5} ä¸ªæ–‡ä»¶...</h4>
                        <p>æ¥è‡ª ${zipName}</p>
                    </div>
                </div>
            `;
            fileList.appendChild(moreItem);
            displayCount++;
        }
    }

    // æ˜¾ç¤ºå¸¸è§„æ–‡ä»¶
    regularFiles.slice(0, maxDisplay - displayCount).forEach(file => {
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        fileItem.innerHTML = `
            <div class="file-info">
                <div class="file-icon">
                    <i class="fas ${getFileIcon(file.name)}"></i>
                </div>
                <div class="file-details">
                    <h4>${file.name}</h4>
                    <p>${formatFileSize(file.size)}</p>
                </div>
            </div>
        `;
        fileList.appendChild(fileItem);
        displayCount++;
    });

    // å¦‚æœè¿˜æœ‰æ›´å¤šæ–‡ä»¶æœªæ˜¾ç¤º
    const remainingFiles = files.length - displayCount;
    if (remainingFiles > 0) {
        const moreItem = document.createElement('div');
        moreItem.className = 'file-item';
        moreItem.innerHTML = `
            <div class="file-info">
                <div class="file-icon">
                    <i class="fas fa-ellipsis-h"></i>
                </div>
                <div class="file-details">
                    <h4>è¿˜æœ‰ ${remainingFiles} ä¸ªæ–‡ä»¶...</h4>
                    <p>ç‚¹å‡»æŸ¥çœ‹å…¨éƒ¨</p>
                </div>
            </div>
        `;
        fileList.appendChild(moreItem);
    }

    fileListSection.style.display = files.length > 0 ? 'block' : 'none';
}

function getFileIcon(filename) {
    const ext = filename.split('.').pop().toLowerCase();
    switch (ext) {
        case 'json': return 'fa-file-code';
        case 'png': case 'jpg': case 'jpeg': return 'fa-image';
        case 'zip': case 'mcpack': case 'mcworld': case 'mctemplate': return 'fa-file-archive';
        default: return 'fa-file';
    }
}

function updateProcessButton() {
    const processBtn = document.getElementById('processBtn');
    processBtn.disabled = selectedFiles.length === 0;
}

function hideResults() {
    document.getElementById('resultsSection').style.display = 'none';
    document.getElementById('downloadBtn').classList.add('hidden');
    document.getElementById('fileListSection').style.display = 'none';
    currentDownloadFilename = null;
}

// æ£€æŸ¥APIçŠ¶æ€
async function checkApiStatus() {
    const statusElement = document.getElementById('api-status');
    
    try {
        const response = await fetch(`${API_BASE}/api/health`);
        const data = await response.json();
        
        if (data.status === 'ok') {
            statusElement.className = 'status-indicator status-online';
            statusElement.innerHTML = '<i class="fas fa-circle"></i> æœåŠ¡åœ¨çº¿';
        } else {
            throw new Error('APIè¿”å›é”™è¯¯çŠ¶æ€');
        }
    } catch (error) {
        statusElement.className = 'status-indicator status-offline';
        statusElement.innerHTML = '<i class="fas fa-circle"></i> æœåŠ¡ç¦»çº¿';
        console.error('APIçŠ¶æ€æ£€æŸ¥å¤±è´¥:', error);
    }
}

// ç”Ÿæˆå¯†é’¥
async function generateKey() {
    const customKeyInput = document.getElementById('customKey');
    
    try {
        const response = await fetch(`${API_BASE}/api/generate-key`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            customKeyInput.value = data.key;
            showToast('å¯†é’¥ç”ŸæˆæˆåŠŸï¼', 'success');
        } else {
            throw new Error(data.error || 'ç”Ÿæˆå¯†é’¥å¤±è´¥');
        }
    } catch (error) {
        showToast('ç”Ÿæˆå¯†é’¥å¤±è´¥: ' + error.message, 'error');
        console.error('ç”Ÿæˆå¯†é’¥å¤±è´¥:', error);
    }
}

// é‡æ–°æ‰“åŒ…ä¸ºZIPçš„è¾…åŠ©å‡½æ•°ï¼ˆå¦‚æœéœ€è¦å‘é€ç»™åç«¯ï¼‰
async function repackAsZip(files, zipName = 'extracted_files.zip') {
    const zip = new JSZip();
    
    for (const file of files) {
        const fileName = file.originalPath || file.webkitRelativePath || file.name;
        zip.file(fileName, file);
    }
    
    const zipBlob = await zip.generateAsync({type: 'blob'});
    return new File([zipBlob], zipName, {type: 'application/zip'});
}

// å¤„ç†æ–‡ä»¶ï¼ˆåŠ å¯†æˆ–è§£å¯†ï¼‰- ä¿®æ”¹ç‰ˆæœ¬
async function processFiles() {
    if (selectedFiles.length === 0) {
        showToast('è¯·å…ˆé€‰æ‹©æ–‡ä»¶', 'error');
        return;
    }

    const customKey = document.getElementById('customKey').value;
    const progressSection = document.getElementById('progressSection');
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const processBtn = document.getElementById('processBtn');
    const resultsSection = document.getElementById('resultsSection');

    // é‡ç½®UI
    resultsSection.style.display = 'none';
    progressSection.style.display = 'block';
    processBtn.disabled = true;
    
    const actionText = currentMode === 'encrypt' ? 'åŠ å¯†' : 'è§£å¯†';
    processBtn.innerHTML = `<span class="spinner"></span> ${actionText}ä¸­...`;

    try {
        // åˆ›å»ºFormData
        const formData = new FormData();
        
        // å¦‚æœæœ‰è§£å‹çš„æ–‡ä»¶ï¼Œéœ€è¦é‡æ–°æ‰“åŒ…ä¸ºZIP
        if (selectedFiles.some(file => file.sourceZip)) {
            updateProgress(10, 'æ­£åœ¨é‡æ–°æ‰“åŒ…æ–‡ä»¶...');
            const repackedZip = await repackAsZip(selectedFiles, 'processed_files.zip');
            formData.append('files', repackedZip);
        } else {
            // æ·»åŠ åŸå§‹æ–‡ä»¶
            selectedFiles.forEach(file => {
                formData.append('files', file);
            });
        }
        
        // æ·»åŠ è‡ªå®šä¹‰å¯†é’¥
        if (customKey.trim()) {
            formData.append('custom_key', customKey.trim());
        }

        // æ›´æ–°è¿›åº¦
        updateProgress(30, `æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...`);

        // é€‰æ‹©APIç«¯ç‚¹
        const endpoint = currentMode === 'encrypt' ? '/api/encrypt' : '/api/decrypt';

        // å‘é€è¯·æ±‚
        const response = await fetch(`${API_BASE}${endpoint}`, {
            method: 'POST',
            body: formData
        });

        updateProgress(70, `æ­£åœ¨${actionText}æ–‡ä»¶...`);

        const data = await response.json();

        if (data.success) {
            updateProgress(100, `${actionText}å®Œæˆï¼`);
            
            setTimeout(() => {
                displayProcessResult(data);
                progressSection.style.display = 'none';
            }, 1000);
        } else {
            throw new Error(data.error || `${actionText}å¤±è´¥`);
        }

    } catch (error) {
        console.error(`${actionText}å¤±è´¥:`, error);
        showToast(`${actionText}å¤±è´¥: ` + error.message, 'error');
        progressSection.style.display = 'none';
    } finally {
        // æ¢å¤æŒ‰é’®
        processBtn.disabled = false;
        const icon = currentMode === 'encrypt' ? 'fa-lock' : 'fa-unlock';
        const text = currentMode === 'encrypt' ? 'å¼€å§‹åŠ å¯†' : 'å¼€å§‹è§£å¯†';
        processBtn.innerHTML = `<i class="fas ${icon}"></i> ${text}`;
    }
}

// æ›´æ–°è¿›åº¦æ¡
function updateProgress(percent, text) {
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    
    progressFill.style.width = percent + '%';
    progressText.textContent = text;
}

// æ˜¾ç¤ºå¤„ç†ç»“æœ
function displayProcessResult(data) {
    const resultsSection = document.getElementById('resultsSection');
    const fileListSection = document.getElementById('fileListSection');
    const processedFiles = document.getElementById('processedFiles');
    const totalFiles = document.getElementById('totalFiles');
    const packageName = document.getElementById('packageName');
    const operationKey = document.getElementById('operationKey');
    const packDetailsInfo = document.getElementById('packDetailsInfo');
    const downloadBtn = document.getElementById('downloadBtn');
    const resultTitle = document.getElementById('resultTitle');
    const processedLabel = document.getElementById('processedLabel');

    // éšè—æ–‡ä»¶åˆ—è¡¨çª—å£
    fileListSection.style.display = 'none';

    // æ›´æ–°æ ‡é¢˜å’Œæ ‡ç­¾
    if (currentMode === 'encrypt') {
        resultTitle.textContent = 'åŠ å¯†ç»“æœ';
        processedLabel.textContent = 'åŠ å¯†æ–‡ä»¶æ•°';
        processedFiles.textContent = data.encrypted_files || 0;
    } else {
        resultTitle.textContent = 'è§£å¯†ç»“æœ';
        processedLabel.textContent = 'è§£å¯†æ–‡ä»¶æ•°';
        processedFiles.textContent = data.decrypted_files || 0;
    }

    // æ›´æ–°ç»Ÿè®¡æ•°æ®
    totalFiles.textContent = data.total_files || 0;
    
    if (data.pack_info && data.pack_info.name) {
        packageName.textContent = data.pack_info.name.substring(0, 10) + (data.pack_info.name.length > 10 ? '...' : '');
        packageName.title = data.pack_info.name;
    } else {
        packageName.textContent = 'æœªçŸ¥';
    }
    
    const keyValue = data.content_key || 's5s5ejuDru4uchuF2drUFuthaspAbepE';
    operationKey.textContent = keyValue.substring(0, 8) + '...';
    operationKey.title = keyValue;

    // æ„å»ºè¯¦ç»†ä¿¡æ¯
    let detailsHTML = '';
    
    if (data.pack_info) {
        const info = data.pack_info;
        detailsHTML += `
            <div class="pack-info-item">
                <span class="pack-info-label">åŒ…åç§°</span>
                <span class="pack-info-value">${info.name || 'æœªçŸ¥'}</span>
            </div>
            <div class="pack-info-item">
                <span class="pack-info-label">æè¿°</span>
                <span class="pack-info-value">${info.description || 'æ— '}</span>
            </div>
            <div class="pack-info-item">
                <span class="pack-info-label">ç‰ˆæœ¬</span>
                <span class="pack-info-value">${info.version || '0.0.0'}</span>
            </div>
            <div class="pack-info-item">
                <span class="pack-info-label">UUID</span>
                <span class="pack-info-value" style="font-family: monospace; word-break: break-all;">${info.uuid || 'æœªçŸ¥'}</span>
            </div>
        `;
    }
    
    detailsHTML += `
        <div class="pack-info-item">
            <span class="pack-info-label">ä½¿ç”¨å¯†é’¥</span>
            <span class="pack-info-value" style="font-family: monospace; word-break: break-all;">${keyValue}</span>
        </div>
    `;

    packDetailsInfo.innerHTML = detailsHTML;

    // è®¾ç½®ä¸‹è½½åŠŸèƒ½
    if (data.download_filename) {
        currentDownloadFilename = data.download_filename;
        downloadBtn.classList.remove('hidden');
    }

    resultsSection.style.display = 'block';
    const actionText = currentMode === 'encrypt' ? 'åŠ å¯†' : 'è§£å¯†';
    showToast(`åŒ…${actionText}æˆåŠŸï¼`, 'success');
}

// ä¸‹è½½ç»“æœ
function downloadResult() {
    if (currentDownloadFilename) {
        downloadFile(currentDownloadFilename);
    } else {
        showToast('æ²¡æœ‰å¯ä¸‹è½½çš„æ–‡ä»¶', 'error');
    }
}

// ä¸‹è½½æ–‡ä»¶
async function downloadFile(filename) {
    try {
        const response = await fetch(`${API_BASE}/api/download/${filename}`);
        
        if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            showToast('æ–‡ä»¶ä¸‹è½½å¼€å§‹', 'success');
        } else {
            throw new Error('ä¸‹è½½å¤±è´¥');
        }
    } catch (error) {
        showToast('ä¸‹è½½å¤±è´¥: ' + error.message, 'error');
        console.error('ä¸‹è½½å¤±è´¥:', error);
    }
}

// æ¸…ç†æ–‡ä»¶
async function cleanupFiles() {
    try {
        const response = await fetch(`${API_BASE}/api/cleanup`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast('ä¸´æ—¶æ–‡ä»¶æ¸…ç†å®Œæˆ', 'success');
        } else {
            throw new Error(data.error || 'æ¸…ç†å¤±è´¥');
        }
    } catch (error) {
        showToast('æ¸…ç†å¤±è´¥: ' + error.message, 'error');
        console.error('æ¸…ç†å¤±è´¥:', error);
    }
}

// æ˜¾ç¤ºToasté€šçŸ¥
function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    
    let icon = 'fa-info-circle';
    if (type === 'success') icon = 'fa-check-circle';
    else if (type === 'error') icon = 'fa-exclamation-triangle';
    else if (type === 'warning') icon = 'fa-exclamation-triangle';
    
    toast.innerHTML = `
        <i class="fas ${icon}"></i>
        ${message}
    `;
    
    toastContainer.appendChild(toast);
    
    setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}
</script>
</body>
</html>
